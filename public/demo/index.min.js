!function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t,e,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function h(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=function(){function t(){n(this,t),this.listenerFunctions=new Map,this.listenerObjects=new Map}return o(t,[{key:"addEventListener",value:function(t,e){var n="function"==typeof e?this.listenerFunctions:this.listenerObjects;n.has(t)?n.get(t).add(e):n.set(t,new Set([e]))}},{key:"removeEventListener",value:function(t,e){var n="function"==typeof e?this.listenerFunctions:this.listenerObjects;if(n.has(t)){var i=n.get(t);i.delete(e),0===i.size&&n.delete(t)}}},{key:"dispatchEvent",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,i=n.listenerFunctions,o=n.listenerObjects;if(t.target=n,i.has(t.type)){e=i.get(t.type);var r=!0,s=!1,a=void 0;try{for(var l,u=e[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)l.value.call(n,t)}catch(t){s=!0,a=t}finally{try{r||null==u.return||u.return()}finally{if(s)throw a}}}if(o.has(t.type)){e=o.get(t.type);var h=!0,c=!1,d=void 0;try{for(var f,p=e[Symbol.iterator]();!(h=(f=p.next()).done);h=!0)f.value.handleEvent(t)}catch(t){c=!0,d=t}finally{try{h||null==p.return||p.return()}finally{if(c)throw d}}}}}]),t}();function d(t,e){var n=t.__state.conversionName.toString(),i=Math.round(t.r),o=Math.round(t.g),r=Math.round(t.b),s=t.a,a=Math.round(t.h),l=t.s.toFixed(1),u=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var h=t.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}return"CSS_RGB"===n?"rgb("+i+","+o+","+r+")":"CSS_RGBA"===n?"rgba("+i+","+o+","+r+","+s+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+o+","+r+"]":"RGBA_ARRAY"===n?"["+i+","+o+","+r+","+s+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+o+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+o+",b:"+r+",a:"+s+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+l+",v:"+u+",a:"+s+"}":"unknown format"}var f=Array.prototype.forEach,p=Array.prototype.slice,m={BREAK:{},extend:function(t){return this.each(p.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(p.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=p.call(arguments);return function(){for(var e=p.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(f&&t.forEach&&t.forEach===f)t.forEach(e,n);else if(t.length===t.length+0){var i,o=void 0;for(o=0,i=t.length;o<i;o++)if(o in t&&e.call(n,t[o],o)===this.BREAK)return}else for(var r in t)if(e.call(n,t[r],r)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i=void 0;return function(){var o=this,r=arguments;function s(){i=null,n||t.apply(o,r)}var a=n||!i;clearTimeout(i),i=setTimeout(s,e),a&&t.apply(o,r)}},toArray:function(t){return t.toArray?t.toArray():p.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)}},_=[{litmus:m.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:d},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:d},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:d},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:d}}},{litmus:m.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:m.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:m.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(m.isNumber(t.r)&&m.isNumber(t.g)&&m.isNumber(t.b)&&m.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(m.isNumber(t.r)&&m.isNumber(t.g)&&m.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(m.isNumber(t.h)&&m.isNumber(t.s)&&m.isNumber(t.v)&&m.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(m.isNumber(t.h)&&m.isNumber(t.s)&&m.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],y=void 0,v=void 0,g=function(){v=!1;var t=arguments.length>1?m.toArray(arguments):arguments[0];return m.each(_,(function(e){if(e.litmus(t))return m.each(e.conversions,(function(e,n){if(y=e.read(t),!1===v&&!1!==y)return v=y,y.conversionName=n,y.conversion=e,m.BREAK})),m.BREAK})),v},b=void 0,x={hsv_to_rgb:function(t,e,n){var i=Math.floor(t/60)%6,o=t/60-Math.floor(t/60),r=n*(1-e),s=n*(1-o*e),a=n*(1-(1-o)*e),l=[[n,a,r],[s,n,r],[r,n,a],[r,s,n],[a,r,n],[n,r,s]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,n){var i=Math.min(t,e,n),o=Math.max(t,e,n),r=o-i,s=void 0;return 0===o?{h:NaN,s:0,v:0}:(s=t===o?(e-n)/r:e===o?2+(n-t)/r:4+(t-e)/r,(s/=6)<0&&(s+=1),{h:360*s,s:r/o,v:o/255})},rgb_to_hex:function(t,e,n){var i=this.hex_with_component(0,2,t);return i=this.hex_with_component(i,1,e),i=this.hex_with_component(i,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(b=8*e)|t&~(255<<b)}},k="function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?function(t){return e(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)},w=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},E=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),A=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0},C=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+e(n));t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},S=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==e(n)&&"function"!=typeof n?t:n},M=function(){function t(){if(w(this,t),this.__state=g.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return E(t,[{key:"toString",value:function(){return d(this)}},{key:"toHexString",value:function(){return d(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function O(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space?this.__state[e]:(M.recalculateRGB(this,e,n),this.__state[e])},set:function(t){"RGB"!==this.__state.space&&(M.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function z(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space?this.__state[e]:(M.recalculateHSV(this),this.__state[e])},set:function(t){"HSV"!==this.__state.space&&(M.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}M.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=x.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");m.extend(t.__state,x.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},M.recalculateHSV=function(t){var e=x.rgb_to_hsv(t.r,t.g,t.b);m.extend(t.__state,{s:e.s,v:e.v}),m.isNaN(e.h)?m.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},M.COMPONENTS=["r","g","b","h","s","v","hex","a"],O(M.prototype,"r",2),O(M.prototype,"g",1),O(M.prototype,"b",0),z(M.prototype,"h"),z(M.prototype,"s"),z(M.prototype,"v"),Object.defineProperty(M.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(M.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=x.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var L=function(){function t(e,n){w(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return E(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),T={};m.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){m.each(t,(function(t){T[t]=e}))}));var P=/(\d+(\.\d+)?)px/;function D(t){if("0"===t||m.isUndefined(t))return 0;var e=t.match(P);return m.isNull(e)?0:parseFloat(e[1])}var R={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var i=n,o=e;m.isUndefined(o)&&(o=!0),m.isUndefined(i)&&(i=!0),t.style.position="absolute",o&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,i){var o=n||{},r=T[e];if(!r)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(r);switch(r){case"MouseEvents":var a=o.x||o.clientX||0,l=o.y||o.clientY||0;s.initMouseEvent(e,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=s.initKeyboardEvent||s.initKeyEvent;m.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(e,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:s.initEvent(e,o.bubbles||!1,o.cancelable||!0)}m.defaults(s,i),t.dispatchEvent(s)},bind:function(t,e,n,i){var o=i||!1;return t.addEventListener?t.addEventListener(e,n,o):t.attachEvent&&t.attachEvent("on"+e,n),R},unbind:function(t,e,n,i){var o=i||!1;return t.removeEventListener?t.removeEventListener(e,n,o):t.detachEvent&&t.detachEvent("on"+e,n),R},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return R},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),i=n.indexOf(e);-1!==i&&(n.splice(i,1),t.className=n.join(" "))}else t.className=void 0;return R},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return D(e["border-left-width"])+D(e["border-right-width"])+D(e["padding-left"])+D(e["padding-right"])+D(e.width)},getHeight:function(t){var e=getComputedStyle(t);return D(e["border-top-width"])+D(e["border-bottom-width"])+D(e["padding-top"])+D(e["padding-bottom"])+D(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},F=function(t){function e(t,n){w(this,e);var i=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),R.bind(i.__checkbox,"change",(function(){o.setValue(!o.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return C(e,t),E(e,[{key:"setValue",value:function(t){var n=A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(L),B=function(t){function e(t,n,i){w(this,e);var o=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i,s=o;if(o.__select=document.createElement("select"),m.isArray(r)){var a={};m.each(r,(function(t){a[t]=t})),r=a}return m.each(r,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),s.__select.appendChild(n)})),o.updateDisplay(),R.bind(o.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),o.domElement.appendChild(o.__select),o}return C(e,t),E(e,[{key:"setValue",value:function(t){var n=A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return R.isActive(this.__select)?this:(this.__select.value=this.getValue(),A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(L),N=function(t){function e(t,n){w(this,e);var i=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;function r(){o.setValue(o.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),R.bind(i.__input,"keyup",r),R.bind(i.__input,"change",r),R.bind(i.__input,"blur",(function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())})),R.bind(i.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return C(e,t),E(e,[{key:"updateDisplay",value:function(){return R.isActive(this.__input)||(this.__input.value=this.getValue()),A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(L);function H(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var V=function(t){function e(t,n,i){w(this,e);var o=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i||{};return o.__min=r.min,o.__max=r.max,o.__step=r.step,m.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=H(o.__impliedStep),o}return C(e,t),E(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=H(t),this}}]),e}(L);var j=function(t){function e(t,n,i){w(this,e);var o=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));o.__truncationSuspended=!1;var r=o,s=void 0;function a(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(t){var e=s-t.clientY;r.setValue(r.getValue()+e*r.__impliedStep),s=t.clientY}function u(){R.unbind(window,"mousemove",l),R.unbind(window,"mouseup",u),a()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),R.bind(o.__input,"change",(function(){var t=parseFloat(r.__input.value);m.isNaN(t)||r.setValue(t)})),R.bind(o.__input,"blur",(function(){a()})),R.bind(o.__input,"mousedown",(function(t){R.bind(window,"mousemove",l),R.bind(window,"mouseup",u),s=t.clientY})),R.bind(o.__input,"keydown",(function(t){13===t.keyCode&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,a())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return C(e,t),E(e,[{key:"updateDisplay",value:function(){var t,n,i;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),n=this.__precision,i=Math.pow(10,n),Math.round(t*i)/i),A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(V);function I(t,e,n,i,o){return i+(t-e)/(n-e)*(o-i)}var U=function(t){function e(t,n,i,o,r){w(this,e);var s=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:i,max:o,step:r})),a=s;function l(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(I(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function u(){R.unbind(window,"mousemove",l),R.unbind(window,"mouseup",u),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function h(t){var e=t.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(I(e,n.left,n.right,a.__min,a.__max))}function c(){R.unbind(window,"touchmove",h),R.unbind(window,"touchend",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),R.bind(s.__background,"mousedown",(function(t){document.activeElement.blur(),R.bind(window,"mousemove",l),R.bind(window,"mouseup",u),l(t)})),R.bind(s.__background,"touchstart",(function(t){if(1!==t.touches.length)return;R.bind(window,"touchmove",h),R.bind(window,"touchend",c),h(t)})),R.addClass(s.__background,"slider"),R.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return C(e,t),E(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(V),G=function(t){function e(t,n,i){w(this,e);var o=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===i?"Fire":i,R.bind(o.__button,"click",(function(t){return t.preventDefault(),r.fire(),!1})),R.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return C(e,t),E(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(L),X=function(t){function e(t,n){w(this,e);var i=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));i.__color=new M(i.getValue()),i.__temp=new M(0);var o=i;i.domElement=document.createElement("div"),R.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",R.bind(i.__input,"keydown",(function(t){13===t.keyCode&&c.call(this)})),R.bind(i.__input,"blur",c),R.bind(i.__selector,"mousedown",(function(){R.addClass(this,"drag").bind(window,"mouseup",(function(){R.removeClass(o.__selector,"drag")}))})),R.bind(i.__selector,"touchstart",(function(){R.addClass(this,"drag").bind(window,"touchend",(function(){R.removeClass(o.__selector,"drag")}))}));var r,s=document.createElement("div");function a(t){f(t),R.bind(window,"mousemove",f),R.bind(window,"touchmove",f),R.bind(window,"mouseup",u),R.bind(window,"touchend",u)}function l(t){p(t),R.bind(window,"mousemove",p),R.bind(window,"touchmove",p),R.bind(window,"mouseup",h),R.bind(window,"touchend",h)}function u(){R.unbind(window,"mousemove",f),R.unbind(window,"touchmove",f),R.unbind(window,"mouseup",u),R.unbind(window,"touchend",u),d()}function h(){R.unbind(window,"mousemove",p),R.unbind(window,"touchmove",p),R.unbind(window,"mouseup",h),R.unbind(window,"touchend",h),d()}function c(){var t=g(this.value);!1!==t?(o.__color.__state=t,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function d(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=o.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,i=n.clientX,r=n.clientY,s=(i-e.left)/(e.right-e.left),a=1-(r-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),o.__color.v=a,o.__color.s=s,o.setValue(o.__color.toOriginal()),!1}function p(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=o.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),o.__color.h=360*n,o.setValue(o.__color.toOriginal()),!1}return m.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),m.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),m.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),m.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),m.extend(s.style,{width:"100%",height:"100%",background:"none"}),Y(s,"top","rgba(0,0,0,0)","#000"),m.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(r=i.__hue_field).style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",m.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),R.bind(i.__saturation_field,"mousedown",a),R.bind(i.__saturation_field,"touchstart",a),R.bind(i.__field_knob,"mousedown",a),R.bind(i.__field_knob,"touchstart",a),R.bind(i.__hue_field,"mousedown",l),R.bind(i.__hue_field,"touchstart",l),i.__saturation_field.appendChild(s),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return C(e,t),E(e,[{key:"updateDisplay",value:function(){var t=g(this.getValue());if(!1!==t){var e=!1;m.each(M.COMPONENTS,(function(n){if(!m.isUndefined(t[n])&&!m.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&m.extend(this.__color.__state,t)}m.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;m.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Y(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),m.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),e}(L),W=["-moz-","-o-","-webkit-","-ms-",""];function Y(t,e,n,i){t.style.background="",m.each(W,(function(o){t.style.cssText+="background: "+o+"linear-gradient("+e+", "+n+" 0%, "+i+" 100%); "}))}var q=function(t,e){var n=e||document,i=document.createElement("style");i.type="text/css",i.innerHTML=t;var o=n.getElementsByTagName("head")[0];try{o.appendChild(i)}catch(t){}},K='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',Q=function(t,e){var n=t[e];return m.isArray(arguments[2])||m.isObject(arguments[2])?new B(t,e,arguments[2]):m.isNumber(n)?m.isNumber(arguments[2])&&m.isNumber(arguments[3])?m.isNumber(arguments[4])?new U(t,e,arguments[2],arguments[3],arguments[4]):new U(t,e,arguments[2],arguments[3]):m.isNumber(arguments[4])?new j(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new j(t,e,{min:arguments[2],max:arguments[3]}):m.isString(n)?new N(t,e):m.isFunction(n)?new G(t,e,""):m.isBoolean(n)?new F(t,e):null};var J=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},Z=function(){function t(){w(this,t),this.backgroundElement=document.createElement("div"),m.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),R.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),m.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;R.bind(this.backgroundElement,"click",(function(){e.hide()}))}return E(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),m.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",R.unbind(t.domElement,"webkitTransitionEnd",e),R.unbind(t.domElement,"transitionend",e),R.unbind(t.domElement,"oTransitionEnd",e)};R.bind(this.domElement,"webkitTransitionEnd",e),R.bind(this.domElement,"transitionend",e),R.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-R.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-R.getHeight(this.domElement)/2+"px"}}]),t}();q(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var $=function(){try{return!!window.localStorage}catch(t){return!1}}(),tt=void 0,et=!0,nt=void 0,it=!1,ot=[],rt=function t(e){var n=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),R.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=m.defaults(i,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),i=m.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),m.isUndefined(i.load)?i.load={preset:"Default"}:i.preset&&(i.load.preset=i.preset),m.isUndefined(i.parent)&&i.hideable&&ot.push(this),i.resizable=m.isUndefined(i.parent)&&i.resizable,i.autoPlace&&m.isUndefined(i.scrollable)&&(i.scrollable=!0);var o,r=$&&"true"===localStorage.getItem(ct(this,"isLocal")),s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(t){n.parent?n.getRoot().preset=t:i.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return i.width},set:function(t){i.width=t,_t(n,t)}},name:{get:function(){return i.name},set:function(t){i.name=t,a&&(a.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(e){i.closed=e,i.closed?R.addClass(n.__ul,t.CLASS_CLOSED):R.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return r},set:function(t){$&&(r=t,t?R.bind(window,"unload",s):R.unbind(window,"unload",s),localStorage.setItem(ct(n,"isLocal"),t))}}}),m.isUndefined(i.parent)){if(this.closed=i.closed||!1,R.addClass(this.domElement,t.CLASS_MAIN),R.makeSelectable(this.domElement,!1),$&&r){n.useLocalStorage=!0;var l=localStorage.getItem(ct(this,"gui"));l&&(i.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,R.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),i.closeOnTop?(R.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(R.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),R.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===i.closed&&(i.closed=!0);var u=document.createTextNode(i.name);R.addClass(u,"controller-name"),a=st(n,u);R.addClass(this.__ul,t.CLASS_CLOSED),R.addClass(a,"title"),R.bind(a,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(m.isUndefined(i.parent)&&(et&&(nt=document.createElement("div"),R.addClass(nt,"dg"),R.addClass(nt,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(nt),et=!1),nt.appendChild(this.domElement),R.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||_t(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},R.bind(window,"resize",this.__resizeHandler),R.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),R.bind(this.__ul,"transitionend",this.__resizeHandler),R.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&mt(this),s=function(){$&&"true"===localStorage.getItem(ct(n,"isLocal"))&&localStorage.setItem(ct(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,i.parent||((o=n.getRoot()).width+=1,m.defer((function(){o.width-=1})))};function st(t,e,n){var i=document.createElement("li");return e&&i.appendChild(e),n?t.__ul.insertBefore(i,n):t.__ul.appendChild(i),t.onResize(),i}function at(t){R.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&R.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function lt(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function ut(t,e){var n=t.getRoot(),i=n.__rememberedObjects.indexOf(e.object);if(-1!==i){var o=n.__rememberedObjectIndecesToControllers[i];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[i]=o),o[e.property]=e,n.load&&n.load.remembered){var r=n.load.remembered,s=void 0;if(r[t.preset])s=r[t.preset];else{if(!r.Default)return;s=r.Default}if(s[i]&&void 0!==s[i][e.property]){var a=s[i][e.property];e.initialValue=a,e.setValue(a)}}}}function ht(t,e,n,i){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var o=void 0;if(i.color)o=new X(e,n);else{var r=[e,n].concat(i.factoryArgs);o=Q.apply(t,r)}i.before instanceof L&&(i.before=i.before.__li),ut(t,o),R.addClass(o.domElement,"c");var s=document.createElement("span");R.addClass(s,"property-name"),s.innerHTML=o.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(o.domElement);var l=st(t,a,i.before);return R.addClass(l,rt.CLASS_CONTROLLER_ROW),o instanceof X?R.addClass(l,"color"):R.addClass(l,k(o.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,m.extend(n,{options:function(e){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),ht(t,n.object,n.property,{before:i,factoryArgs:[m.toArray(arguments)]})}if(m.isArray(e)||m.isObject(e)){var o=n.__li.nextElementSibling;return n.remove(),ht(t,n.object,n.property,{before:o,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof U){var i=new j(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});m.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],o=i[t];n[t]=i[t]=function(){var t=Array.prototype.slice.call(arguments);return o.apply(i,t),e.apply(n,t)}})),R.addClass(e,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof j){var o=function(e){if(m.isNumber(n.__min)&&m.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var r=ht(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(i),o&&r.listen(),r}return e};n.min=m.compose(o,n.min),n.max=m.compose(o,n.max)}else n instanceof F?(R.bind(e,"click",(function(){R.fakeEvent(n.__checkbox,"click")})),R.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof G?(R.bind(e,"click",(function(){R.fakeEvent(n.__button,"click")})),R.bind(e,"mouseover",(function(){R.addClass(n.__button,"hover")})),R.bind(e,"mouseout",(function(){R.removeClass(n.__button,"hover")}))):n instanceof X&&(R.addClass(e,"color"),n.updateDisplay=m.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=m.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&lt(t.getRoot(),!0),e}),n.setValue)}(t,l,o),t.__controllers.push(o),o}function ct(t,e){return document.location.href+"."+e}function dt(t,e,n){var i=document.createElement("option");i.innerHTML=e,i.value=e,t.__preset_select.appendChild(i),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function ft(t,e){e.style.display=t.useLocalStorage?"block":"none"}function pt(t){var e=t.__save_row=document.createElement("li");R.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),R.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",R.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",R.addClass(i,"button"),R.addClass(i,"save");var o=document.createElement("span");o.innerHTML="New",R.addClass(o,"button"),R.addClass(o,"save-as");var r=document.createElement("span");r.innerHTML="Revert",R.addClass(r,"button"),R.addClass(r,"revert");var s=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?m.each(t.load.remembered,(function(e,n){dt(t,n,n===t.preset)})):dt(t,"Default",!1),R.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(n),e.appendChild(i),e.appendChild(o),e.appendChild(r),$){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(ct(0,"isLocal"))&&l.setAttribute("checked","checked"),ft(t,a),R.bind(l,"change",(function(){t.useLocalStorage=!t.useLocalStorage,ft(t,a)}))}var u=document.getElementById("dg-new-constructor");R.bind(u,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||tt.hide()})),R.bind(n,"click",(function(){u.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),tt.show(),u.focus(),u.select()})),R.bind(i,"click",(function(){t.save()})),R.bind(o,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),R.bind(r,"click",(function(){t.revert()}))}function mt(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function i(){R.removeClass(t.__closeButton,rt.CLASS_DRAG),R.unbind(window,"mousemove",n),R.unbind(window,"mouseup",i)}function o(o){return o.preventDefault(),e=o.clientX,R.addClass(t.__closeButton,rt.CLASS_DRAG),R.bind(window,"mousemove",n),R.bind(window,"mouseup",i),!1}t.__resize_handle=document.createElement("div"),m.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),R.bind(t.__resize_handle,"mousedown",o),R.bind(t.__closeButton,"mousedown",o),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function _t(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function yt(t,e){var n={};return m.each(t.__rememberedObjects,(function(i,o){var r={},s=t.__rememberedObjectIndecesToControllers[o];m.each(s,(function(t,n){r[n]=e?t.initialValue:t.getValue()})),n[o]=r})),n}rt.toggleHide=function(){it=!it,m.each(ot,(function(t){t.domElement.style.display=it?"none":""}))},rt.CLASS_AUTO_PLACE="a",rt.CLASS_AUTO_PLACE_CONTAINER="ac",rt.CLASS_MAIN="main",rt.CLASS_CONTROLLER_ROW="cr",rt.CLASS_TOO_TALL="taller-than-window",rt.CLASS_CLOSED="closed",rt.CLASS_CLOSE_BUTTON="close-button",rt.CLASS_CLOSE_TOP="close-top",rt.CLASS_CLOSE_BOTTOM="close-bottom",rt.CLASS_DRAG="drag",rt.DEFAULT_WIDTH=245,rt.TEXT_CLOSED="Close Controls",rt.TEXT_OPEN="Open Controls",rt._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||rt.toggleHide()},R.bind(window,"keydown",rt._keydownHandler,!1),m.extend(rt.prototype,{add:function(t,e){return ht(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return ht(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;m.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&nt.removeChild(this.domElement);var t=this;m.each(this.__folders,(function(e){t.removeFolder(e)})),R.unbind(window,"keydown",rt._keydownHandler,!1),at(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new rt(e);this.__folders[t]=n;var i=st(this,n.domElement);return R.addClass(i,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],at(t);var e=this;m.each(t.__folders,(function(e){t.removeFolder(e)})),m.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=R.getOffset(t.__ul).top,n=0;m.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=R.getHeight(e))})),window.innerHeight-e-20<n?(R.addClass(t.domElement,rt.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(R.removeClass(t.domElement,rt.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&m.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:m.debounce((function(){this.onResize()}),50),remember:function(){if(m.isUndefined(tt)&&((tt=new Z).domElement.innerHTML=K),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;m.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&pt(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&_t(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=yt(this)),t.folders={},m.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=yt(this),lt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=yt(this,!0)),this.load.remembered[t]=yt(this),this.preset=t,dt(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){m.each(this.__controllers,(function(e){this.getRoot().load.remembered?ut(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),m.each(this.__folders,(function(t){t.revert(t)})),t||lt(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&function t(e){0!==e.length&&J.call(window,(function(){t(e)}));m.each(e,(function(t){t.updateDisplay()}))}(this.__listening)},updateDisplay:function(){m.each(this.__controllers,(function(t){t.updateDisplay()})),m.each(this.__folders,(function(t){t.updateDisplay()}))}});var vt,gt=rt,bt=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"demo";n(this,e),this.id=i,this.renderer=null,this.loadingManager=new t.LoadingManager,this.assets=new Map,this.scene=new t.Scene,this.camera=null,this.controls=null,this.ready=!1}return o(e,[{key:"setRenderer",value:function(t){return this.renderer=t,this}},{key:"load",value:function(){return Promise.resolve()}},{key:"initialize",value:function(){}},{key:"render",value:function(t){this.renderer.render(this.scene,this.camera)}},{key:"registerOptions",value:function(t){}},{key:"reset",value:function(){return this.scene=new t.Scene,this.camera=null,null!==this.controls&&(this.controls.dispose(),this.controls=null),this.ready=!1,this}}]),e}(),xt=function(t){function e(t){var i;return n(this,e),(i=l(this,s(e).call(this,t))).previousDemo=null,i.demo=null,i}return r(e,t),e}((function t(e){n(this,t),this.type=e,this.target=null})),kt=new xt("change"),wt=new xt("load"),Et=function(e){function i(e){var o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.aside,u=void 0===a?e:a,h=r.renderer;return n(this,i),(o=l(this,s(i).call(this))).renderer=void 0!==h?h:function(){var n=new t.WebGLRenderer;return n.setSize(e.clientWidth,e.clientHeight),n.setPixelRatio(window.devicePixelRatio),n}(),e.appendChild(o.renderer.domElement),o.clock=new t.Clock,o.menu=new gt({autoPlace:!1}),u.appendChild(o.menu.domElement),o.demos=new Map,o.demo=null,o.currentDemo=null,o}return r(i,e),o(i,[{key:"resetMenu",value:function(){var t=this,e=this.menu.domElement.parentNode,n=new gt({autoPlace:!1});this.demos.size>1&&n.add(this,"demo",Array.from(this.demos.keys())).onChange((function(){return t.loadDemo()}));return e.removeChild(this.menu.domElement),e.appendChild(n.domElement),this.menu.destroy(),this.menu=n,n}},{key:"startDemo",value:function(t){t.id===this.demo&&(t.initialize(),t.registerOptions(this.resetMenu()),t.ready=!0,wt.demo=t,this.dispatchEvent(wt))}},{key:"loadDemo",value:function(){var t=this,e=this.demos.get(this.demo),n=this.currentDemo,i=this.renderer;window.location.hash=e.id,null!==n&&n.reset(),this.menu.domElement.style.display="none",kt.previousDemo=n,kt.demo=e,this.currentDemo=e,this.dispatchEvent(kt),i.clear(),e.load().then((function(){return t.startDemo(e)})).catch(console.error)}},{key:"addDemo",value:function(t){var e=window.location.hash.slice(1),n=this.currentDemo;return this.demos.set(t.id,t.setRenderer(this.renderer)),(null===this.demo&&0===e.length||t.id===e)&&(this.demo=t.id,this.loadDemo()),this.resetMenu(),null!==n&&n.ready&&n.registerOptions(this.menu),this}},{key:"removeDemo",value:function(t){var e,n=this.demos;return n.has(t)&&(n.delete(t),this.demo===t&&n.size>0?(e=n.entries().next().value,this.demo=e[0],this.currentDemo=e[1],this.loadDemo()):(this.demo=null,this.currentDemo=null,this.renderer.clear())),this}},{key:"setSize",value:function(e,n,i){var o=this.currentDemo;if(this.renderer.setSize(e,n,i),null!==o&&null!==o.camera){var r=o.camera;r instanceof t.OrthographicCamera?(r.left=e/-2,r.right=e/2,r.top=n/2,r.bottom=n/-2,r.updateProjectionMatrix()):r instanceof t.CubeCamera||(r.aspect=e/n,r.updateProjectionMatrix())}}},{key:"render",value:function(t){var e=this.currentDemo,n=this.clock.getDelta();null!==e&&e.ready&&e.render(n)}}]),i}(c),At=0,Ct=1,St=2,Mt=3,Ot=4,zt=5,Lt=6,Tt=7,Pt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.x=e,this.y=i,this.z=o}return o(t,[{key:"set",value:function(t,e,n){return this.x=t,this.y=e,this.z=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"setFromSpherical",value:function(t){this.setFromSphericalCoords(t.radius,t.phi,t.theta)}},{key:"setFromSphericalCoords",value:function(t,e,n){var i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}},{key:"setFromCylindrical",value:function(t){this.setFromCylindricalCoords(t.radius,t.theta,t.y)}},{key:"setFromCylindricalCoords",value:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.elements,4*e)}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this}},{key:"crossVectors",value:function(t,e){var n=t.x,i=t.y,o=t.z,r=e.x,s=e.y,a=e.z;return this.x=i*a-o*s,this.y=o*r-n*a,this.z=n*s-i*r,this}},{key:"cross",value:function(t){return this.crossVectors(this,t)}},{key:"transformDirection",value:function(t){var e=this.x,n=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i,this.y=o[1]*e+o[5]*n+o[9]*i,this.z=o[2]*e+o[6]*n+o[10]*i,this.normalize()}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[3]*n+o[6]*i,this.y=o[1]*e+o[4]*n+o[7]*i,this.z=o[2]*e+o[5]*n+o[8]*i,this}},{key:"applyMatrix4",value:function(t){var e=this.x,n=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12],this.y=o[1]*e+o[5]*n+o[9]*i+o[13],this.z=o[2]*e+o[6]*n+o[10]*i+o[14],this}},{key:"applyQuaternion",value:function(t){var e=this.x,n=this.y,i=this.z,o=t.x,r=t.y,s=t.z,a=t.w,l=a*e+r*i-s*n,u=a*n+s*e-o*i,h=a*i+o*n-r*e,c=-o*e-r*n-s*i;return this.x=l*a+c*-o+u*-s-h*-r,this.y=u*a+c*-r+h*-o-l*-s,this.z=h*a+c*-s+l*-r-u*-o,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"reflect",value:function(t){var e=t.x,n=t.y,i=t.z;return this.sub(t.multiplyScalar(2*this.dot(t))),t.set(e,n,i),this}},{key:"angleTo",value:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(e,-1),1))}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}}]),t}(),Dt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.x=e,this.y=i}return o(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)}},{key:"rotateAround",value:function(t,e){var n=Math.cos(e),i=Math.sin(e),o=this.x-t.x,r=this.y-t.y;return this.x=o*n-r*i+t.x,this.y=o*i+r*n+t.y,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"width",get:function(){return this.x},set:function(t){return this.x=t}},{key:"height",get:function(){return this.y},set:function(t){return this.y=t}}]),t}(),Rt="XYZ",Ft="YZX",Bt="ZXY",Nt="XZY",Ht="YXZ",Vt="ZYX",jt=new Pt,It=new Pt,Ut=new Pt,Gt=function(){function t(){n(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return o(t,[{key:"set",value:function(t,e,n,i,o,r,s,a,l,u,h,c,d,f,p,m){var _=this.elements;return _[0]=t,_[4]=e,_[8]=n,_[12]=i,_[1]=o,_[5]=r,_[9]=s,_[13]=a,_[2]=l,_[6]=u,_[10]=h,_[14]=c,_[3]=d,_[7]=f,_[11]=p,_[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements,n=this.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements;for(e=0;e<16;++e)i[e]=t[e+n];return this}},{key:"toArray",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements;for(t=0;t<16;++t)e[t+n]=i[t];return e}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}},{key:"copyPosition",value:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}},{key:"setPosition",value:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this}},{key:"extractBasis",value:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var e=this.elements,n=t.elements,i=1/jt.setFromMatrixColumn(t,0).length(),o=1/jt.setFromMatrixColumn(t,1).length(),r=1/jt.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[7]=0,e[8]=n[8]*r,e[9]=n[9]*r,e[10]=n[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){var e,n,i,o,r,s,a,l,u,h,c,d,f=this.elements,p=t.x,m=t.y,_=t.z,y=Math.cos(p),v=Math.sin(p),g=Math.cos(m),b=Math.sin(m),x=Math.cos(_),k=Math.sin(_);switch(t.order){case Rt:e=y*x,n=y*k,i=v*x,o=v*k,f[0]=g*x,f[4]=-g*k,f[8]=b,f[1]=n+i*b,f[5]=e-o*b,f[9]=-v*g,f[2]=o-e*b,f[6]=i+n*b,f[10]=y*g;break;case Ht:r=g*x,s=g*k,a=b*x,l=b*k,f[0]=r+l*v,f[4]=a*v-s,f[8]=y*b,f[1]=y*k,f[5]=y*x,f[9]=-v,f[2]=s*v-a,f[6]=l+r*v,f[10]=y*g;break;case Bt:r=g*x,s=g*k,a=b*x,l=b*k,f[0]=r-l*v,f[4]=-y*k,f[8]=a+s*v,f[1]=s+a*v,f[5]=y*x,f[9]=l-r*v,f[2]=-y*b,f[6]=v,f[10]=y*g;break;case Vt:e=y*x,n=y*k,i=v*x,o=v*k,f[0]=g*x,f[4]=i*b-n,f[8]=e*b+o,f[1]=g*k,f[5]=o*b+e,f[9]=n*b-i,f[2]=-b,f[6]=v*g,f[10]=y*g;break;case Ft:u=y*g,h=y*b,c=v*g,d=v*b,f[0]=g*x,f[4]=d-u*k,f[8]=c*k+h,f[1]=k,f[5]=y*x,f[9]=-v*x,f[2]=-b*x,f[6]=h*k+c,f[10]=u-d*k;break;case Nt:u=y*g,h=y*b,c=v*g,d=v*b,f[0]=g*x,f[4]=-k,f[8]=b*x,f[1]=u*k+d,f[5]=y*x,f[9]=h*k-c,f[2]=c*k-h,f[6]=v*x,f[10]=d*k+u}return f[3]=0,f[7]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){return this.compose(jt.set(0,0,0),t,It.set(1,1,1))}},{key:"lookAt",value:function(t,e,n){var i=this.elements,o=jt,r=It,s=Ut;return s.subVectors(t,e),0===s.lengthSquared()&&(s.z=1),s.normalize(),o.crossVectors(n,s),0===o.lengthSquared()&&(1===Math.abs(n.z)?s.x+=1e-4:s.z+=1e-4,s.normalize(),o.crossVectors(n,s)),o.normalize(),r.crossVectors(s,o),i[0]=o.x,i[4]=r.x,i[8]=s.x,i[1]=o.y,i[5]=r.y,i[9]=s.y,i[2]=o.z,i[6]=r.z,i[10]=s.z,this}},{key:"multiplyMatrices",value:function(t,e){var n=this.elements,i=t.elements,o=e.elements,r=i[0],s=i[4],a=i[8],l=i[12],u=i[1],h=i[5],c=i[9],d=i[13],f=i[2],p=i[6],m=i[10],_=i[14],y=i[3],v=i[7],g=i[11],b=i[15],x=o[0],k=o[4],w=o[8],E=o[12],A=o[1],C=o[5],S=o[9],M=o[13],O=o[2],z=o[6],L=o[10],T=o[14],P=o[3],D=o[7],R=o[11],F=o[15];return n[0]=r*x+s*A+a*O+l*P,n[4]=r*k+s*C+a*z+l*D,n[8]=r*w+s*S+a*L+l*R,n[12]=r*E+s*M+a*T+l*F,n[1]=u*x+h*A+c*O+d*P,n[5]=u*k+h*C+c*z+d*D,n[9]=u*w+h*S+c*L+d*R,n[13]=u*E+h*M+c*T+d*F,n[2]=f*x+p*A+m*O+_*P,n[6]=f*k+p*C+m*z+_*D,n[10]=f*w+p*S+m*L+_*R,n[14]=f*E+p*M+m*T+_*F,n[3]=y*x+v*A+g*O+b*P,n[7]=y*k+v*C+g*z+b*D,n[11]=y*w+v*S+g*L+b*R,n[15]=y*E+v*M+g*T+b*F,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],n=t[4],i=t[8],o=t[12],r=t[1],s=t[5],a=t[9],l=t[13],u=t[2],h=t[6],c=t[10],d=t[14],f=e*s,p=e*a,m=e*l,_=n*r,y=n*a,v=n*l,g=i*r,b=i*s,x=i*l,k=o*r,w=o*s,E=o*a;return t[3]*(E*h-x*h-w*c+v*c+b*d-y*d)+t[7]*(p*d-m*c+k*c-g*d+x*u-E*u)+t[11]*(m*h-f*d-k*h+_*d+w*u-v*u)+t[15]*(-b*u-p*h+f*c+g*h-_*c+y*u)}},{key:"getInverse",value:function(t){var e,n=this.elements,i=t.elements,o=i[0],r=i[1],s=i[2],a=i[3],l=i[4],u=i[5],h=i[6],c=i[7],d=i[8],f=i[9],p=i[10],m=i[11],_=i[12],y=i[13],v=i[14],g=i[15],b=f*v*c-y*p*c+y*h*m-u*v*m-f*h*g+u*p*g,x=_*p*c-d*v*c-_*h*m+l*v*m+d*h*g-l*p*g,k=d*y*c-_*f*c+_*u*m-l*y*m-d*u*g+l*f*g,w=_*f*h-d*y*h-_*u*p+l*y*p+d*u*v-l*f*v,E=o*b+r*x+s*k+a*w;return 0!==E?(e=1/E,n[0]=b*e,n[1]=(y*p*a-f*v*a-y*s*m+r*v*m+f*s*g-r*p*g)*e,n[2]=(u*v*a-y*h*a+y*s*c-r*v*c-u*s*g+r*h*g)*e,n[3]=(f*h*a-u*p*a-f*s*c+r*p*c+u*s*m-r*h*m)*e,n[4]=x*e,n[5]=(d*v*a-_*p*a+_*s*m-o*v*m-d*s*g+o*p*g)*e,n[6]=(_*h*a-l*v*a-_*s*c+o*v*c+l*s*g-o*h*g)*e,n[7]=(l*p*a-d*h*a+d*s*c-o*p*c-l*s*m+o*h*m)*e,n[8]=k*e,n[9]=(_*f*a-d*y*a-_*r*m+o*y*m+d*r*g-o*f*g)*e,n[10]=(l*y*a-_*u*a+_*r*c-o*y*c-l*r*g+o*u*g)*e,n[11]=(d*u*a-l*f*a-d*r*c+o*f*c+l*r*m-o*u*m)*e,n[12]=w*e,n[13]=(d*y*s-_*f*s+_*r*p-o*y*p-d*r*v+o*f*v)*e,n[14]=(_*u*s-l*y*s-_*r*h+o*y*h+l*r*v-o*u*v)*e,n[15]=(l*f*s-d*u*s+d*r*h-o*f*h-l*r*p+o*u*p)*e):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}},{key:"scale",value:function(t,e,n){var i=this.elements;return i[0]*=t,i[4]*=e,i[8]*=n,i[1]*=t,i[5]*=e,i[9]*=n,i[2]*=t,i[6]*=e,i[10]*=n,i[3]*=t,i[7]*=e,i[11]*=n,this}},{key:"makeScale",value:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeTranslation",value:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,e){var n=Math.cos(e),i=Math.sin(e),o=1-n,r=t.x,s=t.y,a=t.z,l=o*r,u=o*s;return this.set(l*r+n,l*s-i*a,l*a+i*s,0,l*s+i*a,u*s+n,u*a-i*r,0,l*a-i*s,u*a+i*r,o*a*a+n,0,0,0,0,1),this}},{key:"makeShear",value:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this}},{key:"compose",value:function(t,e,n){var i=this.elements,o=e.x,r=e.y,s=e.z,a=e.w,l=o+o,u=r+r,h=s+s,c=o*l,d=o*u,f=o*h,p=r*u,m=r*h,_=s*h,y=a*l,v=a*u,g=a*h,b=n.x,x=n.y,k=n.z;return i[0]=(1-(p+_))*b,i[1]=(d+g)*b,i[2]=(f-v)*b,i[3]=0,i[4]=(d-g)*x,i[5]=(1-(c+_))*x,i[6]=(m+y)*x,i[7]=0,i[8]=(f+v)*k,i[9]=(m-y)*k,i[10]=(1-(c+p))*k,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}},{key:"decompose",value:function(t,e,n){var i=this.elements,o=i[0],r=i[1],s=i[2],a=i[4],l=i[5],u=i[6],h=i[8],c=i[9],d=i[10],f=this.determinant(),p=jt.set(o,r,s).length()*(f<0?-1:1),m=jt.set(a,l,u).length(),_=jt.set(h,c,d).length(),y=1/p,v=1/m,g=1/_;return t.x=i[12],t.y=i[13],t.z=i[14],i[0]*=y,i[1]*=y,i[2]*=y,i[4]*=v,i[5]*=v,i[6]*=v,i[8]*=g,i[9]*=g,i[10]*=g,e.setFromRotationMatrix(this),i[0]=o,i[1]=r,i[2]=s,i[4]=a,i[5]=l,i[6]=u,i[8]=h,i[9]=c,i[10]=d,n.x=p,n.y=m,n.z=_,this}},{key:"makePerspective",value:function(t,e,n,i,o,r){var s=this.elements,a=2*o/(e-t),l=2*o/(n-i),u=(e+t)/(e-t),h=(n+i)/(n-i),c=-(r+o)/(r-o),d=-2*r*o/(r-o);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=h,s[13]=0,s[2]=0,s[6]=0,s[10]=c,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}},{key:"makeOrthographic",value:function(t,e,n,i,o,r){var s=this.elements,a=1/(e-t),l=1/(n-i),u=1/(r-o),h=(e+t)*a,c=(n+i)*l,d=(r+o)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-h,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-c,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}},{key:"equals",value:function(t){var e,n=this.elements,i=t.elements,o=!0;for(e=0;o&&e<16;++e)n[e]!==i[e]&&(o=!1);return o}}]),t}(),Xt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.radius=e,this.phi=i,this.theta=o}return o(t,[{key:"set",value:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}},{key:"setFromVector3",value:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}},{key:"setFromCartesianCoords",value:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Math.min(Math.max(e/this.radius,-1),1))),this}}]),t}(),Wt=0,Yt=1,qt=2,Kt=2*Math.PI,Qt=new Pt,Jt=new Gt,Zt=function(){function t(e,i,o,r){n(this,t),this.position=e,this.quaternion=i,this.target=o,this.settings=r,this.spherical=new Xt}return o(t,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"updateQuaternion",value:function(){var t=this.settings,e=t.rotation;return t.general.orbit?Jt.lookAt(Qt.subVectors(this.position,this.target),e.pivotOffset,e.up):Jt.lookAt(Qt.set(0,0,0),this.target.setFromSpherical(this.spherical),e.up),this.quaternion.setFromRotationMatrix(Jt),this}},{key:"adjustSpherical",value:function(t,e){var n=this.settings,i=n.general.orbit,o=n.rotation,r=this.spherical;return r.theta=o.invertX?r.theta+t:r.theta-t,r.phi=!i&&!o.invertY||i&&o.invertY?r.phi+e:r.phi-e,r.theta=Math.min(Math.max(r.theta,o.minAzimuthalAngle),o.maxAzimuthalAngle),r.phi=Math.min(Math.max(r.phi,o.minPolarAngle),o.maxPolarAngle),r.theta%=Kt,r.makeSafe(),i&&this.position.setFromSpherical(r).add(this.target),this}},{key:"zoom",value:function(t){var e,n,i,o=this.settings,r=o.general,s=o.sensitivity,a=o.zoom,l=this.spherical;return r.orbit&&a.enabled&&(e=t*s.zoom,a.invert&&(e=-e),n=Math.max(a.minDistance,1e-6),i=Math.min(a.maxDistance,1/0),l.radius=Math.min(Math.max(l.radius+e,n),i),this.position.setFromSpherical(l).add(this.target)),this}},{key:"update",value:function(t){}},{key:"lookAt",value:function(t){var e=this.spherical,n=this.position,i=this.target;return i.copy(t),this.settings.general.orbit?Qt.subVectors(n,i):Qt.subVectors(i,n).normalize(),e.setFromVector3(Qt),e.radius=Math.max(e.radius,1e-6),this.updateQuaternion(),this}},{key:"getViewDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pt;return t.setFromSpherical(this.spherical).normalize(),this.settings.general.orbit&&t.negate(),t}}]),t}(),$t=function(){function t(){n(this,t),this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1}return o(t,[{key:"reset",value:function(){return this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1,this}}]),t}(),te=new Pt(1,0,0),ee=new Pt(0,1,0),ne=new Pt(0,0,1),ie=new Pt,oe=function(){function t(e,i,o,r){n(this,t),this.position=e,this.quaternion=i,this.target=o,this.settings=r,this.movementState=new $t}return o(t,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"translateOnAxis",value:function(t,e){ie.copy(t).applyQuaternion(this.quaternion).multiplyScalar(e),this.position.add(ie),this.settings.general.orbit&&this.target.add(ie)}},{key:"translate",value:function(t){var e=this.settings.sensitivity,n=this.movementState,i=t*e.translation;n.backward?this.translateOnAxis(ne,i):n.forward&&this.translateOnAxis(ne,-i),n.right?this.translateOnAxis(te,i):n.left&&this.translateOnAxis(te,-i),n.up?this.translateOnAxis(ee,i):n.down&&this.translateOnAxis(ee,-i)}},{key:"update",value:function(t){this.settings.translation.enabled&&this.translate(t)}},{key:"moveTo",value:function(t){return this.settings.general.orbit?this.target.copy(t):this.position.copy(t),this}}]),t}(),re=new Proxy({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META_LEFT:91,META_RIGHT:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},{get:function(t,e){return e in t?t[e]:1===e.length?e.toUpperCase().charCodeAt(0):void 0}}),se=function(){function t(){n(this,t),this.orbit=!0}return o(t,[{key:"copy",value:function(t){return this.orbit=t.orbit,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),ae=function(){function t(){n(this,t),this.defaultActions=new Map,this.actions=new Map}return o(t,[{key:"reset",value:function(){return this.actions=new Map(this.defaultActions),this}},{key:"setDefault",value:function(t){return this.defaultActions=t,this.reset()}},{key:"copy",value:function(t){return this.defaultActions=new Map(t.defaultActions),this.actions=new Map(t.actions),this}},{key:"clearDefault",value:function(){return this.defaultActions.clear(),this}},{key:"clear",value:function(){return this.actions.clear(),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"has",value:function(t){return this.actions.has(t)}},{key:"get",value:function(t){return this.actions.get(t)}},{key:"set",value:function(t,e){return this.actions.set(t,e),this}},{key:"delete",value:function(t){return this.actions.delete(t)}},{key:"toJSON",value:function(){return{defaultActions:h(this.defaultActions),actions:h(this.actions)}}}]),t}(),le=function(){function t(){n(this,t),this.hold=!1,this.lock=!0}return o(t,[{key:"copy",value:function(t){return this.hold=t.hold,this.lock=t.lock,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),ue=function(){function t(){n(this,t),this.up=new Pt,this.up.copy(ee),this.pivotOffset=new Pt,this.minAzimuthalAngle=-1/0,this.maxAzimuthalAngle=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.invertX=!1,this.invertY=!1}return o(t,[{key:"copy",value:function(t){return this.up.copy(t.up),this.pivotOffset.copy(t.pivotOffset),this.minAzimuthalAngle=null!==t.minAzimuthalAngle?t.minAzimuthalAngle:-1/0,this.maxAzimuthalAngle=null!==t.maxAzimuthalAngle?t.maxAzimuthalAngle:1/0,this.minPolarAngle=t.minPolarAngle,this.maxPolarAngle=t.maxPolarAngle,this.invertX=t.invertX,this.invertY=t.invertY,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),he=function(){function t(){n(this,t),this.rotation=.0025,this.translation=1,this.zoom=.1}return o(t,[{key:"copy",value:function(t){return this.rotation=t.rotation,this.translation=t.translation,this.zoom=t.zoom,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),ce=function(){function t(){n(this,t),this.enabled=!0}return o(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),de=function(){function t(){n(this,t),this.enabled=!0,this.invert=!1,this.minDistance=1e-6,this.maxDistance=1/0}return o(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this.invert=t.invert,this.minDistance=t.minDistance,this.maxDistance=t.maxDistance,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),fe=function(){function t(){n(this,t),this.general=new se,this.keyBindings=new ae,this.keyBindings.setDefault(new Map([[re.W,At],[re.UP,At],[re.A,Ct],[re.LEFT,Ct],[re.S,St],[re.DOWN,St],[re.D,Mt],[re.RIGHT,Mt],[re.X,Ot],[re.SPACE,zt],[re.PAGE_DOWN,Lt],[re.PAGE_UP,Tt]])),this.pointer=new le,this.rotation=new ue,this.sensitivity=new he,this.translation=new ce,this.zoom=new de}return o(t,[{key:"copy",value:function(t){return this.general.copy(t.general),this.keyBindings.copy(t.keyBindings),this.pointer.copy(t.pointer),this.rotation.copy(t.rotation),this.sensitivity.copy(t.sensitivity),this.translation.copy(t.translation),this.zoom.copy(t.zoom),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toDataURL",value:function(){return URL.createObjectURL(new Blob([JSON.stringify(this)],{type:"text/json"}))}}]),t}(),pe=function(){function t(){n(this,t)}return o(t,[{key:"execute",value:function(t){throw new Error("Strategy#execute method not implemented!")}}]),t}(),me=function(t){function e(t,i){var o;return n(this,e),(o=l(this,s(e).call(this))).movementState=t,o.direction=i,o}return r(e,t),o(e,[{key:"execute",value:function(t){var e=this.movementState;switch(this.direction){case _e.FORWARD:e.forward=t;break;case _e.LEFT:e.left=t;break;case _e.BACKWARD:e.backward=t;break;case _e.RIGHT:e.right=t;break;case _e.DOWN:e.down=t;break;case _e.UP:e.up=t}}}]),e}(pe),_e={FORWARD:0,LEFT:1,BACKWARD:2,RIGHT:3,DOWN:4,UP:5},ye=function(t){function e(t,i){var o;return n(this,e),(o=l(this,s(e).call(this))).rotationManager=t,o.zoomIn=i,o}return r(e,t),o(e,[{key:"execute",value:function(t){t&&this.rotationManager.zoom(this.zoomIn?-1:1)}}]),e}(pe),ve=function(){function t(){var e,i,o,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.body;n(this,t),this.dom=a,this.position=r,this.quaternion=s,this.target=new Pt,this.settings=new fe,this.rotationManager=new Zt(r,s,this.target,this.settings),this.translationManager=new oe(r,s,this.target,this.settings),this.strategies=(e=this.rotationManager,i=this.translationManager,o=i.movementState,new Map([[At,new me(o,_e.FORWARD)],[Ct,new me(o,_e.LEFT)],[St,new me(o,_e.BACKWARD)],[Mt,new me(o,_e.RIGHT)],[Ot,new me(o,_e.DOWN)],[zt,new me(o,_e.UP)],[Lt,new ye(e,!1)],[Tt,new ye(e,!0)]])),this.lastScreenPosition=new Dt,this.dragging=!1,this.enabled=!1,null!==r&&null!==s&&(this.lookAt(this.target),null!==a&&this.setEnabled())}return o(t,[{key:"getDom",value:function(){return this.dom}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getTarget",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pt;return t.copy(this.target),this.settings.general.orbit||t.add(this.position),t}},{key:"getViewDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pt;return this.rotationManager.getViewDirection(t)}},{key:"setDom",value:function(t){var e=this.enabled;return null!==t&&(e&&this.setEnabled(!1),this.dom=t,this.setEnabled(e)),this}},{key:"setPosition",value:function(t){return this.position=t,this.rotationManager.setPosition(t),this.translationManager.setPosition(t),this.lookAt(this.target)}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this.rotationManager.setQuaternion(t),this.translationManager.setQuaternion(t),this.lookAt(this.target)}},{key:"setTarget",value:function(t){return this.target=t,this.rotationManager.setTarget(t),this.translationManager.setTarget(t),this.lookAt(this.target)}},{key:"setOrbitEnabled",value:function(t){var e=this.settings.general;return e.orbit!==t&&(this.getTarget(this.target),e.orbit=t,this.lookAt(this.target)),this}},{key:"copy",value:function(t){return this.dom=t.getDom(),this.position=t.getPosition(),this.quaternion=t.getQuaternion(),this.target=t.getTarget(),this.settings.copy(t.settings),this.rotationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.translationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.lookAt(this.target)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"handlePointerMoveEvent",value:function(t){var e,n,i=this.settings,o=i.pointer,r=i.sensitivity,s=this.rotationManager,a=this.lastScreenPosition;document.pointerLockElement===this.dom?o.hold&&!this.dragging||s.adjustSpherical(t.movementX*r.rotation,t.movementY*r.rotation).updateQuaternion():(e=t.screenX-a.x,n=t.screenY-a.y,a.set(t.screenX,t.screenY),s.adjustSpherical(e*r.rotation,n*r.rotation).updateQuaternion())}},{key:"handleTouchMoveEvent",value:function(t){var e=this.settings.sensitivity,n=this.rotationManager,i=this.lastScreenPosition,o=t.touches[0],r=o.screenX-i.x,s=o.screenY-i.y;i.set(o.screenX,o.screenY),t.preventDefault(),n.adjustSpherical(r*e.rotation,s*e.rotation).updateQuaternion()}},{key:"handleMainPointerButton",value:function(t,e){this.dragging=e,this.settings.pointer.lock?this.setPointerLocked():e?(this.lastScreenPosition.set(t.screenX,t.screenY),this.dom.addEventListener("mousemove",this)):this.dom.removeEventListener("mousemove",this)}},{key:"handleAuxiliaryPointerButton",value:function(t,e){}},{key:"handleSecondaryPointerButton",value:function(t,e){}},{key:"handlePointerButtonEvent",value:function(t,e){switch(t.preventDefault(),t.button){case Wt:this.handleMainPointerButton(t,e);break;case Yt:this.handleAuxiliaryPointerButton(t,e);break;case qt:this.handleSecondaryPointerButton(t,e)}}},{key:"handleTouchEvent",value:function(t,e){var n=t.touches[0];t.preventDefault(),e?(this.lastScreenPosition.set(n.screenX,n.screenY),this.dom.addEventListener("touchmove",this)):this.dom.removeEventListener("touchmove",this)}},{key:"handleKeyboardEvent",value:function(t,e){var n=this.settings.keyBindings;n.has(t.keyCode)&&(t.preventDefault(),this.strategies.get(n.get(t.keyCode)).execute(e))}},{key:"handleWheelEvent",value:function(t){this.rotationManager.zoom(Math.sign(t.deltaY))}},{key:"handlePointerLockEvent",value:function(){document.pointerLockElement===this.dom?this.dom.addEventListener("mousemove",this):this.dom.removeEventListener("mousemove",this)}},{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.handlePointerMoveEvent(t);break;case"touchmove":this.handleTouchMoveEvent(t);break;case"mousedown":this.handlePointerButtonEvent(t,!0);break;case"mouseup":this.handlePointerButtonEvent(t,!1);break;case"touchstart":this.handleTouchEvent(t,!0);break;case"touchend":this.handleTouchEvent(t,!1);break;case"keydown":this.handleKeyboardEvent(t,!0);break;case"keyup":this.handleKeyboardEvent(t,!1);break;case"wheel":this.handleWheelEvent(t);break;case"pointerlockchange":this.handlePointerLockEvent()}}},{key:"update",value:function(t){this.rotationManager.update(t),this.translationManager.update(t)}},{key:"moveTo",value:function(t){return this.rotationManager.moveTo(t),this}},{key:"lookAt",value:function(t){return this.rotationManager.lookAt(t),this}},{key:"setPointerLocked",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?document.pointerLockElement!==this.dom&&void 0!==this.dom.requestPointerLock&&this.dom.requestPointerLock():void 0!==document.exitPointerLock&&document.exitPointerLock()}},{key:"setEnabled",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.dom;return this.translationManager.movementState.reset(),t&&!this.enabled?(document.addEventListener("pointerlockchange",this),document.body.addEventListener("keyup",this),document.body.addEventListener("keydown",this),e.addEventListener("mousedown",this),e.addEventListener("mouseup",this),e.addEventListener("touchstart",this),e.addEventListener("touchend",this),e.addEventListener("wheel",this)):!t&&this.enabled&&(document.removeEventListener("pointerlockchange",this),document.body.removeEventListener("keyup",this),document.body.removeEventListener("keydown",this),e.removeEventListener("mousedown",this),e.removeEventListener("mouseup",this),e.removeEventListener("touchstart",this),e.removeEventListener("touchend",this),e.removeEventListener("wheel",this),e.removeEventListener("mousemove",this),e.removeEventListener("touchmove",this)),this.setPointerLocked(!1),this.enabled=t,this}},{key:"dispose",value:function(){this.setEnabled(!1)}}]),t}(),ge=function(e){function i(){var t;return n(this,i),(t=l(this,s(i).call(this,"octree"))).octreeHelper=null,t}return r(i,e),o(i,[{key:"initialize",value:function(){var e=this.scene,n=this.renderer,i=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.3,2e3);i.position.set(10,6,10),this.camera=i;var o=new ve(i.position,i.quaternion,n.domElement);o.settings.pointer.lock=!1,o.settings.zoom.maxDistance=60,o.settings.sensitivity.translation=10,o.settings.sensitivity.zoom=1,o.lookAt(e.position),this.controls=o,e.fog=new t.FogExp2(855309,.025),n.setClearColor(e.fog.color)}},{key:"render",value:function(t){this.controls.update(t),u(s(i.prototype),"render",this).call(this,t)}},{key:"registerOptions",value:function(t){this.points,this.octreeHelper;this.raycaster.registerOptions(t),this.frustumCuller.registerOptions(t)}}]),i}(bt);function be(t){requestAnimationFrame(be),vt.render(t)}function xe(t){document.getElementById("viewport").children[0].style.display="initial"}function ke(t){document.getElementById("viewport").children[0].style.display="none"}window.addEventListener("load",(function(e){var n=document.getElementById("viewport"),i=new t.WebGLRenderer({antialias:!0});i.setSize(n.clientWidth,n.clientHeight),i.setPixelRatio(window.devicePixelRatio),i.setClearColor(0),(vt=new Et(n,{aside:document.getElementById("aside"),renderer:i})).addEventListener("change",xe),vt.addEventListener("load",ke);var o=new ge;o.id!==window.location.hash.slice(1)&&(window.location.hash=""),vt.addDemo(o),be()})),window.addEventListener("resize",function(){var t=0;function e(e){var n=e.target.innerWidth,i=e.target.innerHeight;vt.setSize(n,i),t=0}return function(n){0===t&&(t=setTimeout(e,66,n))}}()),document.addEventListener("keydown",(function(t){var e=this.getElementById("aside");t.altKey&&null!==e&&(t.preventDefault(),e.style.visibility="hidden"===e.style.visibility?"visible":"hidden")}))}(THREE);
